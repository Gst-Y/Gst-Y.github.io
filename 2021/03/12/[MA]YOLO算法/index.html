<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="YOLO算法原理, GWorld">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>YOLO算法原理 | GWorld</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    
<meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>




<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">GWorld</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>档案馆</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">GWorld</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			档案馆
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/3.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">YOLO算法原理</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
                                <span class="chip bg-color">基础知识</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="post-category">
                                人工智能
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-03-12
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    9.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    36 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="gt-YOLOv1"><a href="#gt-YOLOv1" class="headerlink" title="-&gt; YOLOv1"></a>-&gt; YOLOv1</h2><h2 id="Abstract（引言）"><a href="#Abstract（引言）" class="headerlink" title="Abstract（引言）"></a>Abstract（引言）</h2><blockquote>
<p>先前的目标检测工作使用了执行检测的分类器，而YOLO目标检测方法将目标检测当作了一个回归问题，以在空间上分离的bounding boxes(边界盒？)和相关的class probabilities(类的概率)进行框架化。</p>
</blockquote>
<p>　　单个神经网络在一次评估中直接从完整图像预测bounding boxes和class probabilities,由于整个检测流水线是单个网络，因此可以直接在检测性能上进行端对端优化。</p>
<p>　　<strong>当从自然图像泛化到其他领域（如图像）时，它的性能优于其他检测方法，包括DPM和R-CNN</strong><br>　　但是，YOLO的准确率没有最好的检测系统准确率高。YOLO可以快速识别图像中的目标，但是准确定位目标（特别是小目标）有点困难。</p>
<h2 id="1-Introduction（介绍）"><a href="#1-Introduction（介绍）" class="headerlink" title="1.Introduction（介绍）"></a>1.Introduction（介绍）</h2><blockquote>
<p>用于object detection的快速和准确的算法将允许计算机无需专门的传感器来驱动汽车，使辅助设备能够将实时场景信息传达给人类用户。</p>
</blockquote>
<p>　　现在的检测系统重新使用了分类器来实现检测。为了检测一个对象，这些系统对该对象进行分类，并在测试图像中的各种位置和比例下进行评估。诸如可变形部件模型（DPM）的系统使用滑动窗口方法，其中分类器在整个图像上以均匀间隔的位置运行.</p>
<p>　　更先进的一点的方法（例如R-CNN）使用region proposal的方法在一张图片上产生bounding boxes，然后在这些boxes上执行分类。分类后，后处理用于微调bounding boxes，和消除重复检测，并根据场景中的其他对象重新确定框。这些复杂的途径难以优化，因为每个单独的组件必须分开训练。</p>
<p>　　YOLO把object detection视作一个单独的回归问题，直接从图像像素到bounding boxes坐标和类概率，只需要看一眼就知道图片上有什么并且在哪里。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-1.png" alt="YOLO使用示例 - 1.将图片resize到488*488 2.送入CNN网络 3.非极大值抑制去重"></p>
<p>　　YOLO是比较简单的：如上图。一个单个卷积神经网络能够同时预测多个bounding boxes以及他们的概率。YOLO在完整的图像上训练，能够直接优化检测性能。这种统一的模型比传统的object detection方法有几个好处。</p>
<p>　1.快，非常快。YOLO的基础版在Titan X GPU上可以达到45帧/s； 快速版可以达到150帧/s。因此，YOLO可以实现实时检测。<br>　2.YOLO采用全图信息来进行预测。与滑动窗口方法和region proposal-based方法不同，YOLO在训练和预测过程中可以<strong>利用全图信息</strong>。Fast R-CNN检测方法会错误的将背景中的斑块检测为目标，原因在于Fast R-CNN在检测中无法看到全局图像。相对于Fast R-CNN，YOLO背景预测错误率低一半。</p>
<h2 id="2-Unified-Detection（统一检测）"><a href="#2-Unified-Detection（统一检测）" class="headerlink" title="2.Unified Detection（统一检测）"></a>2.Unified Detection（统一检测）</h2><blockquote>
<p>YOLO将object detection的单独组件统一为单个神经网络。YOLO的网络使用整个图像的特征来预测每个bounding boxes，同时还可以预测所有的类的bounding boxes，可实现端到端训练和实时检测，同时保持较高的平均精度。</p>
</blockquote>
<p>　　系统将输入的图片划分为S X S(默认是7*7)个小格子，如果物体的中心(应该是指ground truth box中的物体的中心)落入到某一个小格中，则对应的小格负责检测这个物体。<br>　　每个小格子预测B个bounding boxes以及对应的置信度(confidence scores),这些置信度反映了box包含物体的信心以及<strong>准确度</strong>。我们定义置信度为:<img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/l-1.png"><br>　　如果box中不存在物体，那么confidence scores为0（即意味着Pr(Object) =0），否则，我们希望预测的置信值和ground truth的intersection over union (IOU)相同（即意味着Pr(Object) =1）。<br>每个bounding box由五个预测值组成:x,y,w,h和confidence。(x,y)坐标表示相对于网格单元边界的框的中心。(w,h)为与全图信息相关的box的宽和高。confidence代表了predicted box和任何 ground truth box的IOU。<br>　　每个网格单元还预测 C 条件类概率Pr(Classi|Object)，这些概率适用于包含对象的网格单元格，概率值C代表了格子包含一个目标的概率，每个小格子只预测一组类概率，而不考虑框B的数量。在测试时，每个box通过类别概率和box置信度相乘来得到特定类别置信度：<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-2.png" alt="这个分数代表该类别出现在box中的概率和box和目标的合适度"><br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-3.png" alt="For evaluating YOLO on PASCAL VOC, we use S = 7,B = 2. PASCAL VOC has 20 labelled classes so C = 20.Our final prediction is a 7 × 7 × 30 tensor."></p>
<h3 id="2-1-Network-Design（网络结构）"><a href="#2-1-Network-Design（网络结构）" class="headerlink" title="2.1 Network Design（网络结构）"></a>2.1 Network Design（网络结构）</h3><p>　　模型采用卷积神经网络结构。开始的卷积层提取图像特征，全连接层预测输出概率。模型结构类似于GoogleNet，如下图所示。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-4.png" alt="YOLO的架构示意图"><br>　　除此之外，还训练了YOLO的快速版本（fast YOLO）。Fast YOLO模型卷积层和filter更少。最终输出为7×7×30的tensor。<br>　　两个小细节：<br>　　<strong>1.作者先在ImageNet数据集上预训练网络，而且网络只采用fig3的前面20个卷积层，输入是224x224大小的图像然后在检测的时候加上随机化的4个卷积层和2个全连接层，同时输入改为更高分辨率的448x448。<br>　　2.Relu层改为pRelu，即当x&lt;0时，激活值是0.1*x，而不是传统的0。</strong></p>
<h3 id="2-2-Training（训练）"><a href="#2-2-Training（训练）" class="headerlink" title="2.2 Training（训练）"></a>2.2 Training（训练）</h3><ul>
<li>采用ImageNet 1000-class 数据集来预训练卷积层。预训练阶段，采用图2-2网络中的前20卷积层，外加average pooling层和全连接层。模型训练了一周，获得了top-5 accuracy为0.88（ImageNet2012 validation set），与GoogleNet模型准确率相当。</li>
<li>将模型转换为检测模型。作者向预训练模型中加入了4个卷积层和两层全连接层，提高了模型输入分辨率（224×224–&gt;448×448）</li>
<li>最终层预测类概率和bounding boxes坐标。 通过图像宽度和高度将边界框宽度和高度归一化，使得它们落在0和1之间。我们将边界框x和y坐标参数化为特定网格单元位置的偏移，使得它们也在0和1之间 。</li>
<li>顶层采用linear activation，其它层使用 leaky rectified linear。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-5.png" alt="leaky rectified linear"></li>
<li>使用sum-squared error,因为很容易优化，但它不完全符合我们的最大化平均精度的目标。预测概率的维数比预测bounding box的维数要高，把他们同等对待是不理想的。此外，在每个图像中，许多网格单元不包含任何对象。 这将这些网格单元的“置信度”为零，通常压倒包含对象的网格的梯度。 这可能导致模型不稳定，导致训练早期发散。为了弥补这一点，采用一个办法就是加权，赋予不同的权值，对于Pr(object)=0的格子令 λ_noobj = 0.5,对于Pr(object)=1的格子令 λ_coord = 5.</li>
<li>对不同大小的bounding box预测中，相比于大box预测偏一点，小box预测偏一点肯定更不能被忍受的。而sum-square error loss中对同样的偏移loss是一样。因此预测边界框宽度和高度的平方根，而不是宽度和高度（因为平方根函数的图像随着x的增大会变得平缓）.</li>
</ul>
<h4 id="gt-loss-function（代价函数）"><a href="#gt-loss-function（代价函数）" class="headerlink" title="-&gt; loss function（代价函数）"></a>-&gt; loss function（代价函数）</h4><p><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-6.png" alt="代价函数"><br>　　传统的均方误差在这里效果并不好：<br>　　　1.bbox的维度和class预测向量的维度不同，显然不应该平权。<br>　　　2.对于背景box，confidence为0，这会导致网络不稳定，甚至发散。<br>　　论文采用的方法是加权处理，即对bbox和confidence施加不同的权重。<br>　　　1.bbox预测赋予​ [公式]<br>　　　2.对于背景box，confidence的损失为​ [公式]<br>　　　3.有object的box，loss weight=1。<br>　　但仍然有一个问题：<strong>尺寸小的bbox的偏移误差相对于尺寸大的bbox的偏移误差来说更难以接受。</strong><br>　　这里作者用了一个比较巧妙的方法，将bbox的width和height取平方根，代替原本的width和height。使得发生相同偏移时，尺寸小的bbox反应大。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-7.png"><br>注：引用自 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/147380339">https://zhuanlan.zhihu.com/p/147380339</a> by 稚与</p>
<ul>
<li>只有当某个网格中有object的时候才对classification error进行惩罚。</li>
<li>只有当某个box predictor对某个ground truth box负责的时候，才会对box的coordinate error进行惩罚，而对哪个ground truth box负责就看其预测值和ground truth box的IoU是不是在那个cell的所有box中最大。</li>
</ul>
<h3 id="2-3-Inference-推论"><a href="#2-3-Inference-推论" class="headerlink" title="2.3 Inference (推论)"></a>2.3 Inference (推论)</h3><p>　　对于PASCAL VOC数据集，模型需要对每张图片预测98个bounding box和对应的类别。对于大部分目标只包含一个box；其它有些面积大的目标包含了多个boxes，采用了Non-maximal suppression（非最大值抑制）来提高准确率。</p>
<h3 id="2-4-Limitations-of-YOLO-不足之处"><a href="#2-4-Limitations-of-YOLO-不足之处" class="headerlink" title="2.4 Limitations of YOLO (不足之处)"></a>2.4 Limitations of YOLO (不足之处)</h3><ul>
<li>YOLO的每一个网格只预测两个boxes，一种类别。这导致模型对相邻目标预测准确率下降。因此，YOLO对成队列的目标（如 一群鸟）识别准确率较低。</li>
<li>YOLO是从数据中学习预测bounding boxes，因此，对新的或者不常见角度的目标无法识别。</li>
<li>YOLO的loss函数对small bounding boxes和large bounding boxes的error平等对待，影响了模型识别准确率。因为对于小的bounding boxes，small error影响更大。</li>
</ul>
<h2 id="3-Comparison-to-Other-Detection-Systems（与其他检测系统的比较）"><a href="#3-Comparison-to-Other-Detection-Systems（与其他检测系统的比较）" class="headerlink" title="3.Comparison to Other Detection Systems（与其他检测系统的比较）"></a>3.Comparison to Other Detection Systems（与其他检测系统的比较）</h2><blockquote>
<p>目标检测是计算机视觉中的核心问题。</p>
</blockquote>
<p>　　检测管道通常从输入图像（Haar [25]，SIFT [23]，HOG [4]，卷积特征[6]）提取一组鲁棒特征开始。 然后，使用分类器[36,21,13,10]或定位器[1,32]来识别特征空间中的目标。这些分类器或定位器以滑动窗口方式在整个图像上或在图像中的一些区域子集上运行[35,15,39]。我们将YOLO检测系统与几个顶级检测框架进行比较，强调了关键的相似点和差异。</p>
<ul>
<li><strong>Deformable parts models</strong>：使用滑动窗口方法目标检测。DPM使用不相交管道来提取静态特征，分类区域，预测高评分区域的边界框等。YOLO用单个卷积神经网络替换所有这些不同的部分。网络执行特征提取，边界框预测，最大抑制和上下文推理。代替静态特征，网络训练串联的特征并且优化它们用于检测任务。YOLO的统一架构造就了比DPM更快，更准确的模型。</li>
<li><strong>R-CNN</strong>：RCNN及其变体使用region proposals，而不是滑动窗口来找到图像中的目标。选择性搜索生成潜在的边界框，卷积网络提取特征，SVM分数框，线性模型调整边界框，非最大抑制消除重复检测。这个复杂流水线的每个阶段都必须独立进行精确调整，得到的系统非常慢，在测试时间每个图像需要超过40秒。<br>YOLO与RCNN有一些相似之处：每个网格单元提出了潜在的边界框并使用卷积特征对那些框进行分数。 然而，YOLO的系统将空间约束放在网格单元建议上，这有助于减轻同一目标的多个检测。 YOLO还提出了很少的边界框，每个图像只有98个，而选择性搜索约为2000个。最后，YOLO系统将这些单独的组件组合成一个单独的，联合优化的模型。</li>
<li><strong>Other Fast Detectors</strong>：Fast和faster RCNN专注于通过共享计算和使用神经网络来提高区域而不是选择性搜索来加速RCNN框架。 虽然他们提供的速度和准确性的改进超过RCNN，但仍然低于实时性能。许多研究工作集中在加速DPM管道。 他们加速HOG计算，使用级联，并推动计算到GPU。 然而，实际上只有30Hz的DPM 实时运行。<br>YOLO完全抛去管道，而不是尝试优化大型检测管道的单个组件，因此设计快(<strong>is fast by design？</strong>)。单个类如面部或人的检测器可以高度优化，因为它们必须处理更少的variation。YOLO是一个通用的检测器，可以同时检测多种物体。</li>
<li><strong>Deep MultiBox</strong>：与RCNN不同，Szegedy et al等人训练卷积神经网络以预测感兴趣的区域，而不是使用选择性搜索。MultiBox还可以通过用单个类别预测替换置信预测来执行单个目标检测。然而，MultiBox不能执行一般的目标检测，并且仍然只是一个更大的检测管道中的一块，需要进一步的图像补丁分类。YOLO和MultiBox都使用卷积网络来预测图像中的边界框，但YOLO是一个完整的检测系统。</li>
<li><strong>OverFeat</strong>：Sermanet等人训练卷积神经网络以执行定位并使该定位器适于执行检测。 Over-Feat有效地执行滑动窗口检测，但它仍然是一个不相交的系统。Over-Feat优化了本地化，而不是检测性能。像DPM一样，定位器在进行预测时仅看到本地信息。OverFeat不能推测全局上下文，因此需要大量的后处理来产生相干检测。</li>
<li><strong>MultiGrasp</strong>：YOLO的工作在设计上类似于Redmon等人的抓握检测工作。YOLO的网格方法到边界框预测是基于Multi-Grasp系统用于回归到抓握。然而，抓取检测是比目标检测简单得多的任务。Multi-Grasp只需要为包含一个目标的图像预测单个可抓取区域。它不必估计目标的大小，位置或边界或预测它的类，只找到适合抓握的区域。YOLO预测图像中多个类的多个目标的边界框和类概率。</li>
</ul>
<h2 id="4-Experiments（实验）"><a href="#4-Experiments（实验）" class="headerlink" title="4. Experiments（实验）"></a>4. Experiments（实验）</h2><p>　　首先，我们在PASCAL VOC 2007上比较YOLO和其他实时检测系统。为了理解YOLO和RCNN变体之间的差异，我们探讨了YOLO和Fast RCNN在性能最高的版本之一 的RCNN [14]。 基于不同的误差曲线，我们显示YOLO可以用于重排fast RCNN检测，并减少背景误报的误差，提供显着的性能提升。 我们还提出VOC 2012结果，并将mAP与当前最先进的方法进行比较。 最后，我们表明YOLO推广到新的领域比其他探测器两个艺术品数据集。</p>
<h3 id="4-1-Comparison-to-Other-Real-Time-Systems（与其他实时系统的比较）"><a href="#4-1-Comparison-to-Other-Real-Time-Systems（与其他实时系统的比较）" class="headerlink" title="4.1. Comparison to Other Real-Time Systems（与其他实时系统的比较）"></a>4.1. Comparison to Other Real-Time Systems（与其他实时系统的比较）</h3><p>　　目标检测中的许多研究工作重点在于快速制作标准检测流水线。但是，只有Sadeghi et al等实际上产生实时运行的检测系统（每秒30帧或更好）。我们将YOLO与其在30Hz或100Hz运行的DPM的GPU实现进行比较。尽管其他努力没有达到实时里程碑，我们还比较了它们的相对mAP和速度，以检查目标检测系统中可用的精度性能权衡。</p>
<ul>
<li>Fast YOLO是PASCAL上最快的目标检测方法;据我们所知，它是最快的现存目标检测器。使用52.7％的mAP，它是以前的实时检测工作的两倍以上。YOLO将mAP推向63.4％，同时仍保持实时性能。</li>
<li>我们还使用VGG-16训练YOLO。这个模型更准确，但也明显慢于YOLO。它对于与依赖VGG-16的其他检测系统的比较是有用的，但是由于它比实时慢，所以本文的其余部分集中在我们更快的模型上。</li>
<li>最快的DPM有效地加速DPM，而不牺牲许多mAP，但它仍然错过2倍的实时性能[38]。它也受到DPM相对于神经网络方法的相对低的检测精度的限制。</li>
<li>RCNN减R代替选择性搜索与静态边界框建议[20]。 虽然它比RCNN快得多，但仍然没有实时性，并且由于没有好的建议而产生显着的准确性。</li>
<li>Fast RCNN加速了RCNN的分类阶段，但它仍然依赖于选择性搜索，每个图像可以花费大约2秒来生成边界框提议。 因此，它具有高mAP，但是在0.5fps它仍然远离实时。<br>最近的faster RCNN取代了选择性搜索与神经网络提出边界框，类似于Szegedy等人在我们的测试中，他们最准确的模型达到7 fps，而较小的，不太准确的模式以18 fps运行。 Faster RCNN的VGG-16版本是10 个百分点的mAP或更高，但是也比YOLO慢6倍。Zeiler-Fergus的faster RCNN只比YOLO慢2.5倍，但也不太准确。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/t-1.png" alt="Comparison"></li>
</ul>
<h3 id="4-2-VOC-2007-Error-Analysis（VOC-2007数据集上误差分析）"><a href="#4-2-VOC-2007-Error-Analysis（VOC-2007数据集上误差分析）" class="headerlink" title="4.2. VOC 2007 Error Analysis（VOC 2007数据集上误差分析）"></a>4.2. VOC 2007 Error Analysis（VOC 2007数据集上误差分析）</h3><p>　　为了进一步检验YOLO和最先进的检测器之间的差异，我们将详细分析VOC 2007的结果。我们将YOLO与Fast RCNN进行比较，因为快速RCNN是最高性能的检测器之一 P ASCAL，它的检测是公开的。</p>
<p>　　我们使用Hoiem等人的方法和工具。对于测试时的每个类别，我们查看该类别的前N个预测。 每个预测是正确的或者基于错误的类型分类：</p>
<ul>
<li>正确：正确的类和IOU &gt; .5</li>
<li>定位：正确的类，.1 &lt; IOU &lt;.5</li>
<li>类似：类相似，IOU &gt; .1</li>
<li>其他：类错了，IOU &gt; .1</li>
<li>背景：对于任何目标，IOU &lt;.1</li>
</ul>
<p><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-8.png" alt="误差分析"></p>
<p>　　误差分析：fast RCNN与YOLO这些图表显示各种类别（在该类别中N =＃个目标）的前N个检测中的定位和背景错误的百分比。<br>　　图中显示了在所有20个类中平均的每个错误类型的细分。<br>　　YOLO努力正确地定位目标。 定位错误占所有YOLO的错误比所有其他来源组合。 Fast RCNN使定位误差少得多，但背景误差大得多。 它的13.6％的顶部检测是假阳性，不包含任何目标。 快速RCNN比YOLO预测背景检测的可能性高出3倍。</p>
<h3 id="4-3-Combining-Fast-R-CNN-and-YOLO（结合fast-RCNN和YOLO）"><a href="#4-3-Combining-Fast-R-CNN-and-YOLO（结合fast-RCNN和YOLO）" class="headerlink" title="4.3. Combining Fast R-CNN and YOLO（结合fast RCNN和YOLO）"></a>4.3. Combining Fast R-CNN and YOLO（结合fast RCNN和YOLO）</h3><p>　　YOLO比Fast RCNN的背景错误少得多。通过使用YOLO来消除Fast RCNN的背景检测，我们获得了显着的性能提升。对于RCNN预测的每个边界框，我们检查YOLO是否预测类似的框。如果是，我们基于由YOLO预测的概率和两个框之间的重叠，给予该预测增强。<br>　　最好的Fast RCNN模型在VOC 2007测试集上达到71.8％的mAP。当与YOLO组合时，其mAP增加了3.2％至75.0％。我们还尝试结合顶部fast RCNN模型与其他几个版本的Fast RCNN。这些集合在mAP中产生0.3％和0.6％之间的小的增加，详见表2。<br>　　来自YOLO的提升不仅仅是模型组合的副产品，因为组合不同版本的Fast RCNN几乎没有什么好处。相反，它是正确的因为YOLO在测试时产生了不同的错误，它在提升Fast RCNN的性能方面非常有效。<br>　　不幸的是，这种组合并没有受益于YOLO的速度，因为我们分别运行每个模型，然后组合结果。然而，由于YOLO是如此之快，与快速RCNN相比它不增加任何显着的计算时间。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/t-2.png" alt="对VOC 2007的模型组合实验"><br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/t-3.png" alt="PASCAL VOC 2012排行榜"></p>
<h3 id="4-4-VOC-2012-Results（VOC-2012结果）"><a href="#4-4-VOC-2012-Results（VOC-2012结果）" class="headerlink" title="4.4. VOC 2012 Results（VOC 2012结果）"></a>4.4. VOC 2012 Results（VOC 2012结果）</h3><p>　　在VOC 2012测试集上，YOLO得分为57.9％mAP。这低于现有技术水平，更接近使用VGG-16的原始RCNN，参见表3.我们的系统与小目标相比，其最接近的竞争对手。在类别如瓶，羊和电视/显示器YOLO得分比RCNN或特征编辑低8-10％。 然而，在其他类别如猫和火车YOLO实现更高的性能。</p>
<p>　　fast RCNN + YOLO模型是最高性能的检测方法之一。 快速RCNN从与YOLO的组合得到了2.3％的改进，提高了5个点在公众排行榜上。</p>
<h3 id="4-5-Generalizability-Person-Detection-in-Artwork（通用性：艺术品中的人检测）"><a href="#4-5-Generalizability-Person-Detection-in-Artwork（通用性：艺术品中的人检测）" class="headerlink" title="4.5. Generalizability: Person Detection in Artwork（通用性：艺术品中的人检测）"></a>4.5. Generalizability: Person Detection in Artwork（通用性：艺术品中的人检测）</h3><p>　　用于目标检测的学术数据集从相同的分布中抽取训练和测试数据。在实际应用中，很难预测所有可能的用例，测试数据可能与系统在[3]之前所看到的不同。我们比较YOLO与Picasso数据集[12]和人 - 艺术数据集[3]上的其他检测系统，两个数据集用于测试艺术品上的人物检测。</p>
<p>　　图5显示YOLO和其他检测方法之间的比较性能。作为参考，我们给VOC 2007检测人上面的AP，其中所有模型仅训练VOC 2007数据。毕加索模型在VOC 2012培训，而人 - 艺术培训VOC 2010。</p>
<p>　　RCNN在VOC 2007上具有高AP。然而，当应用于艺术品时，RCNN显着下降。 RCNN使用选择性搜索来调整自然图像的边界框建议。RCNN中的分类器步骤仅仅看到小区域并且需要好的建议。</p>
<p>　　DPM在应用于艺术品时保持其AP良好。先前的工作理论认为DPM执行良好，因为它具有强大的目标的形状和布局的空间模型。尽管DPM不会降低与RCNN一样多，但是它从较低的AP开始。</p>
<p>　　YOLO在VOC 2007上具有良好的性能，并且当应用于艺术品时，其AP降解少于其他方法。相似的DPM，YOLO模拟目标的大小和形状，以及目标之间的关系以及目标通常出现的位置。图像和自然图像在像素级别上非常不同，但是它们在目标的大小和形状方面是相似的，因此YOLO仍然可以预测良好的边界框和检测。</p>
<h2 id="5-Real-Time-Detection-In-The-Wild（野外实时检测）"><a href="#5-Real-Time-Detection-In-The-Wild（野外实时检测）" class="headerlink" title="5. Real-Time Detection In The Wild（野外实时检测）"></a>5. Real-Time Detection In The Wild（野外实时检测）</h2><p>　　YOLO是一个快速，精确的目标检测器，使其成为计算机视觉应用的理想选择。 我们将YOLO连接到网络摄像头，并验证其是否保持实时性能，包括从相机获取图像并显示检测结果的时间。</p>
<p>　　结果系统是互动和参与。 虽然YOLO单独处理图像，但当连接到网络摄像头时，它的功能类似于跟踪系统，检测目标在移动时的外观变化。 系统演示和源代码可以在我们的项目网站上找到：http：//pjreddie.com/yolo/<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/1-9.png"></p>
<h2 id="6-Conclusion（结论）"><a href="#6-Conclusion（结论）" class="headerlink" title="6. Conclusion（结论）"></a>6. Conclusion（结论）</h2><p>　　YOLO，一个统一的目标检测模型。 YOLO的模型很容易构建，可以直接在完整的图像上进行训练。 不同于基于分类器的方法，YOLO被训练的损失函数直接对应于检测性能，整个模型联合训练。</p>
<p>　　快速YOLO是文献中最快的通用目标检测器，YOLO推动了实时目标检测中的最先进的技术。 YOLO也广泛适用于新的领域，使其成为依赖于快速，强大的目标检测的应用程序的理想选择。</p>
<h2 id="gt-YOLOv2"><a href="#gt-YOLOv2" class="headerlink" title="-&gt; YOLOv2"></a>-&gt; YOLOv2</h2><blockquote>
<p>《YOLO9000:Better, Faster, Stronger》 by Joseph Redmon∗†, Ali Farhadi∗†</p>
</blockquote>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>　　改进后的网络称为YOLO v2，在标准的检测任务中，比如PASCAL VOC和COCO，它也是一个先进的目标检测网络。<br>　　YOLO v2使用新颖的多尺度训练方法，相同的YOLOv2模型可以在不同的图像大小下运行，并在速度和准确度之间提供简单的权衡。<br>　　在VOC 2007数据集上，YOLOv2实现了67FPS和76.8mAP。在40FPS时，YOLOv2获得78.6mAP，优于最先进的方法，如使用ResNet和SSD的Faster R-CNN，同时运行速度明显更快。<br>　　论文提出了一个联合训练目标检测和分类任务的方法。使用这个方法，我们在COCO检测数据集和ImageNet分类数据集上同时训练YOLO9000网络。<br>　　<strong>我们的联合训练使得YOLO9000可以预测没有标签的检测数据的对象类别。</strong>ImageNet的检测任务验证了网络的有效性：YOLO9000在ImageNet检测验证集上获得了19.7mAP，尽管在200个类中只有44个类具有检测数据。在COCO不包含的156个类别中，YOLO9000获得了16.0 mAP。 但YOLO可以检测到超过200个类别; 它预测了超过9000种不同对象类别的检测。并且它仍然可以实时运行。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/2-1.png" alt="YOLO v1 与 YOLO v2的对比"></p>
<h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h2><p>　　通用目标检测应该是快速的，准确的并且能够识别各种各样的物体。由于神经网络的发展，检测网络已经变得越来越快速和准确。<strong>然而，大多数检测网络仍然受限于很少的物体范围内。</strong><br>　　与用于分类和标记等其他任务的数据集相比，当前目标检测数据集是有限的。最常见的检测数据集包含数千到数十万个具有数十到数百个标签的图像。而分类数据集具有数百万个具有数十或数十万个类别的图像。<br>　　我们希望检测能扩展到物体分类的级别。然而，用于检测的标签图像比用于分类或标记的标签要昂贵得多（标记通常是用户免费提供的）。因此，我们不太可能在不久的将来看到与分类数据集相同规模的检测数据集。<br>　　我们提出了一种新方法来利用我们已有的大量的分类数据，并用它来扩展当前检测系统的范围。<strong>我们的方法使用物体分类的分层视图，允许我们将不同的数据集组合在一起。</strong><br>　　我们还提出了一种联合训练算法，<strong>该算法允许我们在检测和分类数据上训练目标检测网络。我们的方法利用标记的检测图像来学习精确定位物体，同时使用分类图像来增加其词汇量和鲁棒性。</strong><br>　　使用这种方法，我们训练YOLO9000，一个可以检测超过9000种不同物体类别的实时目标检测网络。首先，我们改进了基础YOLO检测网络，以得到YOLOv2，这是一种先进的实时检测网络。然后我们使用<strong>数据集组合方法</strong>和<strong>联合训练算法</strong>来训练来自ImageNet以及COCO检测数据的超过9000个类的模型。</p>
<h2 id="2-Better"><a href="#2-Better" class="headerlink" title="2. Better"></a>2. Better</h2><p>　　与先进的检测系统相比，YOLO存在各种缺点。与Fast R-CNN相比，YOLO的错误分析表明YOLO产生了大量的定位误差。 此外，与基于region proposal的方法相比，YOLO具有相对较低的召回率。 因此，我们主要关注改善召回率和定位，同时保持分类准确性。<br>　　计算机视觉通常趋向于更大，更深的网络。更好的性能通常取决于训练更大的网络或集合多个模型。但是，对于YOLOv2，我们需要更准确的检测，但速度仍然很快。我们没有扩展网络，而是简化网络，然后使特征表示更容易学习。我们将过去工作中的各种想法与我们自己的新思想结合起来，以提高YOLO的性能。</p>
<ul>
<li><font color="blue">关于召回率：Recall是被正确识别出来的样本个数与测试集中所有样本的个数的比值。</font></li>
</ul>
<h3 id="2-1-Batch-Normalization"><a href="#2-1-Batch-Normalization" class="headerlink" title="2.1 Batch Normalization"></a>2.1 Batch Normalization</h3><p>　　批量归一化导致收敛的显着改善，同时消除了对其他形式的正则化的需要。通过在YOLO中的所有卷积层上添加批量标准化，我们可以使mAP提高2％以上。批量标准化也有助于模型正则化。通过批量标准化，我们可以从模型中删除dropout而不会过度拟合。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/bc-1.png" alt="批量归一化原理"></p>
<ul>
<li><font color="blue">加入BN层的优点:<ul>
<li>加快训练速度，这样我们就可以使用较大的学习率来训练网络。</li>
<li>提高网络的泛化能力。</li>
<li>BN层本质上是一个归一化网络层，可以替代局部响应归一化层（LRN层）。</li>
<li>可以打乱样本训练顺序（这样就不可能出现同一张照片被多次选择用来训练）论文中提到可以提高1%的精度。</li></ul></font></li>
</ul>


<h3 id="2-2-High-Resolution-Classifier"><a href="#2-2-High-Resolution-Classifier" class="headerlink" title="2.2 High Resolution Classifier"></a>2.2 High Resolution Classifier</h3><p>　　所有最先进的检测方法都使用在ImageNet上预先训练的分类器。从AlexNet开始，大多数分类器在小于256 * 256的输入图像上运行。原始的YOLO训练分类器网络为<strong>224 * 224</strong>并增加分辨率为<strong>448 * 448</strong>进行检测。这意味着<strong>网络必须同时切换到学习目标检测并调整到新的输入分辨率</strong>。</p>
<ul>
<li><font color="blue">关于ImageNet：ImageNet项目是一个用于视觉对象识别软件研究的大型可视化数据库。超过1400万的图像URL被ImageNet手动注释，以指示图片中的对象;在至少一百万个图像中，还提供了边界框。ImageNet包含2万多个类别; [2]一个典型的类别，如“气球”或“草莓”，包含数百个图像。</font></li>
</ul>
<p>　　对于YOLOv2，我们首先在ImageNet上以<strong>完整的448 * 448分辨率</strong>微调分类网络10个epoch。这使网络有时间调整其卷积核，以便在更高分辨率的输入上更好地工作。然后我们在检测时对生成的网络进行微调。<strong>高分辨率分类网络使我们的mAP增加了近4％。</strong></p>
<h3 id="2-3-Convolutional-With-Anchor-Boxes"><a href="#2-3-Convolutional-With-Anchor-Boxes" class="headerlink" title="2.3 Convolutional With Anchor Boxes"></a>2.3 Convolutional With Anchor Boxes</h3><p>　　YOLO直接使用卷积特征提取器顶部的全连接层预测边界框的坐标。而不是直接预测坐标的Faster R-CNN使用手工挑选的先验预测边界框。仅使用卷积层，Faster R-CNN中的区域提议网络（RPN）预测anchor boxes的偏移和置信度。由于预测层是卷积的，因此RPN在特征图中的每个位置预测这些偏移。预测偏移而不是坐标简化了问题，使网络更容易学习。<br>　　我们移除了YOLO网络中的全连接层并使用anchor boxes来预测边界框。首先，我们移除一个pooling层，使网络卷积层的输出分辨率更高。我们还缩小网络以在416 * 416输入图像而不是448 * 448上操作。我们这样做是因为我们想要在我们的特征图中有奇数个位置，所以只有一个中心单元格。物体，特别是大物体，往往占据图像的中心，因此最好在中心有一个位置来预测这些物体而不是附近的四个位置。YOLO的卷积层将图像缩小了32倍，因此通过使用416 * 416的输入图像，我们得到13 * 13的输出特征图。</p>
<ul>
<li><font color="blue">关于Anchor box：其实就是从训练集中将所有的矩形框的大小尺寸统计处最常出现的某几个矩形框，这里我们可以采用K-Means来得到。这样也就不难理解使用anchor的目的了：目标先验。即我们提前告诉模型，应该去用多大的矩形框去寻找目标，帮助模型快速收敛。</font></li>
</ul>
<p>　　当我们使用anchor boxes时，我们还将类预测机制与空间位置预测分离，而是预测每个anchor box的类和objectness（指anchor boxes中是否有物体）。同YOLO网络一样，objectness预测仍然预测真实框与预测框之间的IOU（Pr(Object) * IOU），并且类别预测在给定存在对象的情况下预测该类的条件概率（Pr(Class[i] | Object)）。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/2-2.png" alt="计算过程如图所示"><br>　　使用anchor boxes我们的准确性会<strong>略有下降</strong>。 YOLO仅预测每张图片98个boxes，但是使用anchor boxes我们的模型预测超过1000个boxes。没有anchor boxes，我们的中间模型获得69.5 mAP，召回率为81％。使用anchor boxes，我们的模型获得69.2 mAP，召回率为88％。<strong>虽然mAP减少，召回的增加也意味着我们的模型有更大的改进空间。</strong></p>
<h3 id="2-4-Dimension-Clusters"><a href="#2-4-Dimension-Clusters" class="headerlink" title="2.4 Dimension Clusters"></a>2.4 Dimension Clusters</h3><p>　　在YOLO网络中使用anchor boxes时，我们遇到了两个问题。首先是box维度是手工挑选的。网络可以学会适当地调整框，如果我们从网络中选择更好的先验，我们可以让网络更容易学习预测好的检测。</p>
<ul>
<li><font color="blue">关于此处K-means的使用：在使用K-Means前，需要将标注数据转换获得每个bounding box(标注框)的高宽并归一化(假设你的标注数据是voc数据集的格式)，接下来就是使用K-Means算法将刚刚处理后的bounding box的高宽集合进行分类。K-Means中的距离计算使用1-IOU，每个bounding box的坐标由其高宽表示。记住：我们要寻找的是高宽相似的bounding box聚类后中心box作为anchor box。</font><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">def</span> <span class="token function">iou</span><span class="token punctuation">(</span>bbox<span class="token punctuation">,</span> clusters<span class="token punctuation">)</span><span class="token punctuation">:</span>
  "
  计算某一个bounding box与当前的聚类中心框<span class="token punctuation">(</span>这里为<span class="token number">9</span>个<span class="token punctuation">)</span>的交并比。
  <span class="token punctuation">:</span>param bbox<span class="token punctuation">:</span>单个待归类的bounding box
  <span class="token punctuation">:</span>param clusters<span class="token punctuation">:</span>当前的聚类中心框
  <span class="token punctuation">:</span><span class="token keyword">return</span><span class="token punctuation">:</span> 交并比
  "
  <span class="token comment" spellcheck="true"># 将clusters中的中心框宽限定不大于当前box的宽</span>
  x <span class="token operator">=</span> np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>clusters<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment" spellcheck="true"># 将clusters中的中心框高限定不大于当前box的高</span>
  y <span class="token operator">=</span> np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>clusters<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> np<span class="token punctuation">.</span>count_nonzero<span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">or</span> np<span class="token punctuation">.</span>np<span class="token punctuation">.</span>count_nonzero<span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
      <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'This box is invalid!'</span><span class="token punctuation">)</span>
  intersection <span class="token operator">=</span> x <span class="token operator">*</span> y
  box_area <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  clusters_area <span class="token operator">=</span> clusters<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> clusters<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token comment" spellcheck="true">#交并比公式</span>
  box_iou <span class="token operator">=</span> intersection <span class="token operator">/</span> <span class="token punctuation">(</span>box_area <span class="token operator">+</span> cluster_area <span class="token operator">-</span> intersection<span class="token punctuation">)</span>
  <span class="token keyword">return</span> box_iou
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<font color="blue">解释一下上面的intersection，即我们用某一个box去和clusters中每一个中心框求交并比，所以主要地，也就是两个框的共同覆盖区域。那么，共同覆盖区域自然地也就是两者高宽中较小的，因此求得了任意两个框的共同覆盖区域=intersection。</font><br>　　我们不是手动选择先验，而是在训练集边界框上运行k-means聚类，以自动找到好的先验。 如果我们使用具有欧几里德距离的标准k-means，那么较大的框会产生比较小的框更多的误差。然而，我们真正想要的是能够获得良好IOU分数的先验，这与盒子boxes的大小无关。 因此，对于我们的距离度量，我们使用：<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/2-3.png"><br>　　我们为各种k值运行k-means并绘制具有最接近聚类中心的平均IOU，参见Figure2。我们选择k = 5作为模型复杂度和高召回率之间的良好权衡。<strong>聚类中心与与手工挑选的anchor boxes明显不同。宽，短的boxes更少，相反高，瘦的boxes更多。</strong><br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/v2-1.png" alt="Figure 2"><br>　　我们比较聚类策略和手工挑选anchor boxes的平均IOU，如Table 1所示。只有5个聚类中心时的性能与9个anchor boxes性能类似，即平均IOU为61.0 VS. 60.9。如果我们使用9个聚类中心，我们会看到更高的平均IOU (67.2)。<strong>这表明使用k-means生成我们的边界框会以更好的表示方式启动模型，使任务更容易学习。</strong></li>
</ul>
<h3 id="2-5-Direct-Location-Prediction"><a href="#2-5-Direct-Location-Prediction" class="headerlink" title="2.5  Direct Location Prediction"></a>2.5  Direct Location Prediction</h3><p>　　在YOLO网络中使用anchor boxes时，我们遇到了第二个问题：模型不稳定，特别是在早期迭代期间。大多数不稳定性来自于预测box的（x, y）位置。在区域提议网络RPN中，网络预测值 tx 和 ty，并且（x, y）中心坐标计算为：<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/2-4.png"><br>　　<strong>例如，tx = 1的预测会将框box向右移动anchor box的宽度，tx = -1的预测会将其向左移动相同的量。</strong><br>　　这个公式是不受约束的，因此任何anchor box都可以在图像中的任何位置结束，无论预测box的位置如何。随机初始化，模型需要很长时间才能稳定以预测合理的偏移。<br>　　我们不是预测偏移offset，而是遵循YOLO的方法，预测相对于网格单元的位置坐标。 这将真实框限制在0和1之间。我们使用逻辑激活logistics activation来约束网络预测落在此范围内。<br>　　网络在输出的feature map中预测每个单元格的5个边界框。网络预测每个边界框的 5 个坐标，tx，ty，tw，th和to。如果单元格从图像的左上角偏移（cx, cy）并且前面的边界框具有宽度和高度pw，ph，则预测对应于：<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/2-5.png"><br>　　由于我们约束位置进行预测，因此参数化更容易学习，使网络更稳定。<strong>使用维度聚类以及直接预测边界框中心位置可使YOLO比使用anchor boxes的版本提高近5％。</strong></p>
<h3 id="2-6-Fine-Grained-Features"><a href="#2-6-Fine-Grained-Features" class="headerlink" title="2.6 Fine-Grained Features"></a>2.6 Fine-Grained Features</h3><p>　　改进后的YOLO在13 * 13特征图上预测检测。虽然这对于大型物体来说已足够，但它可能会受益于用于定位较小对象的更细粒度的特征。Faster R-CNN和SSD都在网络中的各种特征图上运行其提议网络RPN，以获得一系列分辨率。我们采用不同的方法，只需添加一个直通层passthrough layer，以26 * 26的分辨率从较早的层中获取特征。<br>　　直通层通过将相邻特征堆叠到不同的通道而不是空间位置，将较高分辨率的特征与低分辨率特征连接起来，类似于ResNet中的identity mappings。这将 26 * 26 * 512 特征图转换为 13 * 13 * 2048 特征图，可以与原始特征连接。我们的检测器运行在这个扩展的特征图之上，因此它可以访问细粒度的特征。这使得性能提高1％。</p>
<ul>
<li><font color="blue">关于直通层：本质其实就是特征重排，26x26x512的feature map分别按行和列隔点采样，可以得到4幅13x13x512的特征，把这4张特征按channel串联起来，就是最后的13x13x2048的feature map.还有就是，passthrough layer本身是不学习参数的，直接用前面的层的特征重排后拼接到后面的层，越在网络前面的层，感受野越小，有利于小目标的检测。</font></li>
</ul>
<h3 id="2-7-Multi-Scale-Training"><a href="#2-7-Multi-Scale-Training" class="headerlink" title="2.7 Multi-Scale Training"></a>2.7 Multi-Scale Training</h3><p>　　最初的YOLO使用输入分辨率为448 * 448。通过添加锚定框，我们将分辨率更改为416 * 416。但是，由于我们的模型<strong>仅使用卷积和池化层，因此可以动态调整大小</strong>。我们希望YOLOv2能够在<strong>不同尺寸的图像</strong>上运行，因此我们将其训练到模型中。<br>　　这种方式迫使网络学习如何在各种输入维度上做好预测。这意味着同一网络可以预测不同分辨率的检测。网络在较小的图像尺寸运行得更快，因此YOLOv2可在速度和精度之间轻松权衡。<br>　　<strong>在低分辨率下，YOLOv2作为相当精确的检测器运行。</strong>在288 * 288分辨率时，它的运行速度超过90 FPS，mAP几乎与Fast R-CNN一样好。这使其成为较小GPU，高帧率视频或多视频流的理想选择。<br>　　<strong>在高分辨率下，YOLOv2是最先进的检测器，在VOC 2007上具有78.6 mAP，同时仍然高于实时速度。</strong>有关YOLOv2与VOC 2007其他框架的比较，请参阅Table 3，Figure 4.<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/v2-2.png" alt="Figure 4"><br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/v2-3.png" alt="Table 3"></p>
<h3 id="2-8-Further-Experiment"><a href="#2-8-Further-Experiment" class="headerlink" title="2.8 Further Experiment"></a>2.8 Further Experiment</h3><p>　　我们训练YOLOv2用于<strong>检测VOC 2012数据集</strong>。Table 4 展示了YOLOv2与其他最先进的检测系统的性能比较。YOLOv2达到73.4 mAP，同时检测速度比其它方法快得多。我们还在<strong>COCO数据集</strong>上进行训练并在Table 5 中的其他方法进行比较。在VOC指标（IOU = 0.5）上，YOLOv2达到44.0 mAP，与SSD和更快的R-CNN相当。<br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/2-6.png" alt="Table 4"><br><img src="/2021/03/12/[MA]YOLO%E7%AE%97%E6%B3%95/v2-4.png" alt="Table 5"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Gst_Y</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://stblog.tk/2021/03/12/%5BMA%5DYOLO%E7%AE%97%E6%B3%95/">http://stblog.tk/2021/03/12/%5BMA%5DYOLO%E7%AE%97%E6%B3%95/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Gst_Y</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
                                    <span class="chip bg-color">基础知识</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'Soxz4R15Dr5CF1zyhssT0GFd-gzGzoHsz',
        appKey: '34UY9eecQEyqKo8lLe1BGpVF',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/03/12/%5BMA%5D%E5%9B%BE%E7%89%87%E5%A2%9E%E5%BC%BA/">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="图像预处理-暗光图像优化">
                        
                        <span class="card-title">图像预处理-暗光图像优化</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文提出了一种新的神经网络来增强曝光不足的照片。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-03-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="post-category">
                                    人工智能
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%9F%BA%E7%A1%80%E6%8B%93%E5%B1%95/">
                        <span class="chip bg-color">基础拓展</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/03/06/%5BD2%5D%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="汇编语言">
                        
                        <span class="card-title">汇编语言</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            汇编语言是直接在硬件之上工作的编程语言，首先要了解硬件系统的结构，才能有效的应用汇编语言对其编程。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-03-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8/" class="post-category">
                                    网络空间安全
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B/">
                        <span class="chip bg-color">大学课程</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('500')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: GWorld<br />'
            + '文章作者: Gst_Y<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Gst_Y</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:by1134516880@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1134516880" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1134516880" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

    <script src="/js/cursor.js"></script>
    <script src="/js/snow.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>

</html>
